<!DOCTYPE html>
<html lang="ja">
	<head>
		<meta charset="utf-8" />
		<meta http-equiv="X-UA-Compatible" "content=IE=edge">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<link rel="stylesheet" href="https://unpkg.com/leaflet@1.3.1/dist/leaflet.css" integrity="sha512-Rksm5RenBEKSKFjgI3a41vrjkw4EVPlJ3+OiI65vTjIdo9brlAacEuKOiQ5OFh7cOI1bkDwLqdLw3Zg0cRJAAQ==" crossorigin="">
		<script src="https://unpkg.com/leaflet@1.3.1/dist/leaflet.js" integrity="sha512-/Nsx9X4HebavoBvEBuyp3I7od5tA0UzAxs+j83KgC8PU0kgB4XiK4Lfe4y4cgBtaRJQEIFCW+oC506aPT2L1zw==" crossorigin=""></script>
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
		<link rel="stylesheet" href="css/style.css">
		<title>ひょうごfree-wifiマップ</title>

	</head>
		<body>
		<header>
		<h1>ひょうごfree-wifiマップ</h1>
		</header>

			<button onClick="setCurLocation()">現在地を表示</button>
			<div id="mapcontainer" style="height: 800px;"></div>
			<script>
					var map = L.map('mapcontainer', { zoomControl: false });
					map.setView([34.691, 135.181], 15);
					var marker=L.marker([34.691, 135.181]).addTo(map);
					var gsiattr = "<a href='https://maps.gsi.go.jp/development/ichiran.html' target='_blank'>地理院タイル</a>";
					//var blank = L.tileLayer('https://cyberjapandata.gsi.go.jp/xyz/blank/{z}/{x}/{y}.png', { attribution: gsiattr });
					var gsi = L.tileLayer('https://cyberjapandata.gsi.go.jp/xyz/std/{z}/{x}/{y}.png', { attribution: gsiattr });
					var gsipale = L.tileLayer('https://cyberjapandata.gsi.go.jp/xyz/pale/{z}/{x}/{y}.png', { attribution: gsiattr });
					var osm = L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png',
							{ attribution: "<a href='https://www.openstreetmap.org/copyright' target='_blank'>OpenStreetMap</a> contributors" });


					var baseMaps = {
						//"地理院白地図": blank,
						"地理院標準地図": gsi,
						"地理院淡色地図": gsipale,
						"オープンストリートマップ": osm
					};
					
					L.control.layers(baseMaps).addTo(map);
					gsipale.addTo(map);
					

					$.getJSON("/geojson/hy_freewifi.geojson",function(data) {
                		L.geoJson(data).bindPopup(function(layer){
                    		return layer.feature.properties.施設名;     //施設名
                		}).addTo(mymap);
            		});


					function setCurLocation(){
						if (navigator.geolocation == false){
							alert('お使いのブラウザでは現在地を取得できません。');
							return;
						}
						else
						{

						function success(p) {
							var lat  = p.coords.latitude;
							var lng = p.coords.longitude;
							map.setView([lat, lng], 15);
							marker.setLatLng([lat,lng]);
						};

						function error(e) {
							// エラーコードのメッセージを定義
								var errorMessage = {
									0: "原因不明のエラーが発生しました。" ,
									1: "位置情報の取得が許可されませんでした。端末の位置情報取得を許可してください。" ,
									2: "電波状況などで位置情報が取得できませんでした。" ,
									3: "位置情報の取得に時間がかかり過ぎてタイムアウトしました。" ,
								} ;
							alert(errorMessage[e.code] );
						};
					}

						navigator.geolocation.getCurrentPosition(success, error);
					}
			</script>
		</body>
<!-- フッタ -->
<footer>
		<small>Copyright © Hyogo Prefectural Government. All rights reserved.</small>
</footer>


</div>
</body>
</html>
